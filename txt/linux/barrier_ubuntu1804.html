<!DOCTYPE html>
<html>
<!-- header_start -->
<head>
	<meta http-equiv="Pragma" content="no-cache">
	<meta http-equiv="Cache-Control" content="no-cache">
	<meta http-equiv="Expires" content="0">
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	
	<title>140文字以上</title>
<!--
	<link rel="icon" type="image/x-icon" href="https://chromabox.github.io/140m/css/favicon.ico">
	<link rel="apple-touch-icon" sizes="180x180" href="https://chromabox.github.io/140m/css/apple-touch-icon-180x180.png">
-->
	<script type="text/javascript">
	if ((navigator.userAgent.indexOf('iPhone') > 0 && navigator.userAgent.indexOf('iPad') == -1) || navigator.userAgent.indexOf('iPod') > 0 || navigator.userAgent.indexOf('Android') > 0) {
		document.write('<link rel="stylesheet" type="text/css" href="https://chromabox.github.io/140m/css/style_smt.css">');
	}else {
		document.write('<link href="https://fonts.googleapis.com/css?family=M+PLUS+1p:300,400&amp;subset=japanese" rel="stylesheet">');
		document.write('<link rel="stylesheet" type="text/css" href="https://chromabox.github.io/140m/css/style_pc.css">');
	}
	</script>
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/solid.css" integrity="sha384-QokYePQSOwpBDuhlHOsX0ymF6R/vLk/UQVz3WHa6wygxI5oGTmDTv8wahFOSspdm" crossorigin="anonymous">
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/brands.css" integrity="sha384-n9+6/aSqa9lBidZMRCQHTHKJscPq6NW4pCQBiMmHdUCvPN8ZOg2zJJTkC7WIezWv" crossorigin="anonymous">
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/fontawesome.css" integrity="sha384-vd1e11sR28tEK9YANUtpIOdjGW14pS87bUBuOIoBILVWLFnS+MCX9T6MMf0VdPGq" crossorigin="anonymous">
	<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
	<link rel="stylesheet" type="text/css" href="https://chromabox.github.io/140m/css/common_style.css">
</head>
<!-- header_end -->

<!-- body_start -->
<body>

<!-- title_start -->
<div id="blog-title-bx">
  <div id="blog-title-content">
	<h1 id="blog-title-font">
	<a href="https://chromabox.github.io/140m/">140文字以上</a>
	</h1>
  <div id="blog-subtitle-content">
	<h4 id="blog-subtitle-font">
	<p>140文字では伝わらないことを書いています。禁無断転載</p>
    <p><a href="https://twitter.com/chromarock">twitter(@chromarock)</a>、<a href="https://github.com/chromabox">github</a>、<a href="https://www.amazon.jp/hz/wishlist/ls/2IWGNZS26U41G?ref_=wl_share">ほしいものリスト</a>、<a href="https://chromabox.github.io/140m/txt/profile.html">その他プロフィール</a></p>
	</h4>
  </div>
  </div>
</div>
<div id="title-content-line"></div>
<!-- title_end -->


<!-- content_start -->
<div id="content-bx">

<!-- header_box_start -->
<header class="header-box">
<!-- entry_time_start -->
	<h4 class="entry-time-title"><i class="fa fa-clock"></i> 2020/09/16</h4>
<!-- entry_time_end -->
<!-- entry_name_start -->
	<h1 class="entry-title"><a href="https://chromabox.github.io/140m/txt/linux/barrier_ubuntu1804.html">ubuntu 18.04でbarrierを使う</a></h1>
<!-- entry_name_end -->
<!-- entry_category_start -->
	<div class="entry-categories categories"><a href="https://chromabox.github.io/140m/txt/linux/index.html" class="entry-category-link">Linux</a>
<!-- entry_category_end -->
</header>
<!-- header_box_end -->

<div class="main-box-spacer"></div>

<!-- main_box_start -->
<div class="main-box">
	<p>
	barrierはWindowsとLinuxやらMacOSXとLinuxを一つのキーボード、2つのPCで共用している時に役に立つソフトです。<br>
	キーボード切替器がなくてもWindowsとLinuxを行き来ができて、クリップボードも共有できるので2台以上のPCを扱っている場合はほぼ必須ですね。</p>
	<p>
	ただ、Ubuntu18.04ではaptでインストールできるのはSynergyのみとなっています。もともとbarrierはSynergyが有料化してしまったためにそれに反発する有志がフォークで作られたものです。<br>
	まぁ、Synergyでも良いっちゃ良いのですが、Ubuntu18で使う時にXorg(QT?)との相性が悪いのか以下の問題があります。</p>
	<p>・マウスをDragしているといきなり切れてWinの画面にマウスカーソルが戻ることがある。<br>
	(Linuxの負荷が上がってる場合とか、QT使ってると起こりやすい感じ)</p>
	<p>・Linuxで日本語を入力しているとリターンが暴発するときがある</p>
	<p>・コピーペーストに失敗する場合がある</p>
	<p></p>
	<p>この問題はフォーク先のbarrierでも長らく問題にはなってましたが、今年の5月かそこらにようやく治り、この反映を行った2.3.3がリリースされました。</p>
	<p>
	というわけでbarrierを導入しようということですが、これにはソースからビルドする必要があり、今回はその手順などを書いておきます。
今回はWindowsPCをサーバ、UbuntuPCをクライアントとします。</p>

<div class="content-2-box">
<div class="content-2-title"><h3>WindowsPCにbarrierのインストール</h3></div>
<p>
これは超簡単です。<br>
以下からインストーラ込みのバイナリ(2.3.3)をダウンロードしてインストールしてサーバ設定するだけです。<br>
<a href="https://github.com/debauchee/barrier/releases/download/v2.3.3/BarrierSetup-2.3.3-release.exe">https://github.com/debauchee/barrier/releases/download/v2.3.3/BarrierSetup-2.3.3-release.exe</a>
</p>

</pre>
</div>

<div class="content-2-box">
<div class="content-2-title"><h3>Ubuntu 18.04でbarrierをソースからビルドする</h3></div>
<p>
次はUbuntu18.04にbarrierを導入するのですが、バイナリイメージはなく、ソースからビルドしないといけません。<br>
とは言ってもビルドはそんなに難しくはなくて、barrierのGithubに書いてある<a href="https://github.com/debauchee/barrier/wiki/Building-on-Linux">これ</a>を見ればいいわけですが、手順を書いておきます。
</p>
<p>1.ビルドに必要なパッケージをインストール</p>

<pre class="code_font codebox">
$ sudo apt install git cmake make xorg-dev g++ libcurl4-openssl-dev \
libavahi-compat-libdnssd-dev libssl-dev libx11-dev \
libqt4-dev qtbase5-dev
</pre>

<p>2.ソースをgithubからダウンロード</p>
<pre class="code_font codebox">
$ git clone https://github.com/debauchee/barrier.git
</pre>
	
<p>3.バージョン2.3.3のブランチをきって、ビルドする</p>
<pre class="code_font codebox">
$ cd barrier
$ git checkout v2.3.3
$ ./clean_build.sh
</pre>

<p>4.ビルドして問題がなければ、Daemon指定で堕ちてしまうバグを治すパッチを当ててもう一回ビルドする</p>
<pre class="code_font codebox">
$ wget https://gist.githubusercontent.com/chromabox/61404314887e61c1c32e325a6dc37e41/raw/a83699cc038dc547bb90aab6af6e810200ddee04/barrier-2_3_3-Fix-daemon-mode-execute-missing.patch
$ git checkout -b v2.3.3_mod
$ git am barrier-2_3_3-Fix-daemon-mode-execute-missing.patch
$ ./clean_build.sh
</pre>
<p>※このパッチはbarriercをDaemon指定で走らせた時にすぐに堕ちてしまうのを私が直したものです。<br>
	これを適用しないと、PCの電源が入ってログイン画面時に実行する時に実行できなくなってしまいます。<br>
	daemonとして起動しているのにSTDINを使用しようとしているのが問題であり、STDINを開かないようにしています。</p>

<p>5.ビルドして問題がなければ、インストールする</p>
<pre class="code_font codebox">
$ cd build
$ sud make install
</pre>
<p>※デフォルトでは/usr/local 以下に入ります。</p>
</div>

<div class="content-2-box">
<div class="content-2-title"><h3>barrierを起動時に有効にする(lightdm)</h3></div>
<p>これはSynergycのときと同じです<br>
ログイン時にbarrierc(barrierのクライアント)を利かせる場合は次のようにします</p>
	
<pre class="code_font codebox">
$ sudo touch /etc/lightdm/lightdm.conf.d/50-barrierc.conf
</pre>
で、「50-barrierc.conf」を作成した後、同ファイルを以下のように編集。
<pre class="code_font codebox">
<div class="code_filebox">/etc/lightdm/lightdm.conf.d/50-barrierc.conf</div>
[SeatDefaults]
greeter-setup-script=/usr/local/bin/barrierc --debug INFO --name サーバで名前設定したこのPCの名前 サーバのIP
</pre>
</div>
	



	
<!-- footer_start -->
<div class="main-box-spacer"></div>
<div class="twitter">
<a href="//twitter.com/share" class="twitter-share-button" data-text="140文字以上：ubuntu 18.04でbarrierを使う" data-url="https://chromabox.github.io/140m/txt/linux/barrier_ubuntu1804.html" data-lang="ja"></a>
</div>
<!-- footer_end -->
</div>
<!-- main_box_end -->

</div>
<!-- content_end -->
</body>
<!-- body_end -->
</html>
