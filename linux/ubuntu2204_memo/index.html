<!doctype html>

<html lang="ja">
  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="generator" content="Hugo 0.117.0">
  
  
<meta property="og:site_name"           content="140文字以上">
<meta property="og:title"               content="ubuntu 22.04設定メモ">
<meta property="twitter:title"          content="ubuntu 22.04設定メモ">
<meta property="og:url"                 content="https://chromabox.github.io/140m/linux/ubuntu2204_memo/">
<meta property="og:type"                content="article">
<meta property="og:description"         content="正式にUbnutu 22.04 LTSがリリースされ、Japan Remix（日本語環境向けに調整されたもの）もリリースされたので、18.04 LTSだった">
<meta property="twitter:description"    content="正式にUbnutu 22.04 LTSがリリースされ、Japan Remix（日本語環境向けに調整されたもの）もリリースされたので、18.04 LTSだった">

    <meta property="og:image"       content="https://chromabox.github.io/140m/cards/default_card.jpg">
    <meta property="og:image:url"   content="https://chromabox.github.io/140m/cards/default_card.jpg">


  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/solid.min.css" integrity="sha512-bdTSJB23zykBjGDvyuZUrLhHD0Rfre0jxTd0/jpTbV7sZL8DCth/88aHX0bq2RV8HK3zx5Qj6r2rRU/Otsjk+g==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/brands.min.css" integrity="sha512-L+sMmtHht2t5phORf0xXFdTC0rSlML1XcraLTrABli/0MMMylsJi3XA23ReVQkZ7jLkOEIMicWGItyK4CAt2Xw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/fontawesome.min.css" integrity="sha512-cHxvm20nkjOUySu7jdwiUxgGy11vuVPE9YeK89geLMLMMEOcKFyS2i+8wo0FOwyQO/bL8Bvq1KMsqK4bbOsPnA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=M+PLUS+1p:300,400,500,700&amp;subset=japanese">
<link rel="stylesheet" href="https://chromabox.github.io/140m/css/bootstrap.min.css">
<link rel="stylesheet" href="https://chromabox.github.io/140m/css/syntax-highlight.css">

  
  
  <title>ubuntu 22.04設定メモ | 140文字以上</title>
  <style>
.container {
  max-width: 1200px;
}


body {
	margin: 0;
	padding: 0;
	color: #303030; 
	background: rgb(245,250,254);  
	background: linear-gradient(135deg,  rgba(255,255,255,1) 0%,rgba(178,216,239,1) 100%);  
  line-height: 1.7;
}

a {
	color: #337a33;
	text-decoration: underline;
  word-wrap:break-word;
}

#btitle-border {
  border-bottom: 1px solid #ccc;
}

#btitle {
  padding: 2rem 0 1rem 0;
}
#btitle a {
	font-weight: 400;
  font-size: 26px;
  color: #303030;
  text-decoration: none;
}

#bstitle {
  padding: 0 0 0 0;
}
#bstitle p {
  padding: 0 0 0 0;
  margin: 0 0 0.1rem 0;
}
#bstitle h4 {
	font-weight: 300;
  font-size: 12px;
}

#main {
  margin-top: 1em;
  margin-bottom: 1em;
}

#footer .my-container {
  padding: 1em 0;
}
#footer a {
  color: inherit;
  text-decoration: underline;
}

.blog-post, .blog-pagination {
  margin-bottom: 1rem;
}

.page-item.disabled .page-link {
  background-color: inherit;
}

.page-link {
  background-color: inherit;
}

.blog-post-date {
	font-weight: 300;
  font-size: 12px;
}

.blog-post-title {
  margin: 0;
  padding: 0 0 0 0;
  font-weight: 500;
  font-size: 26px;
}


.my-container {
  max-width: 1200px;
}

.header-box {
	border: 1px solid #808080;
  padding-top: 0.5rem;
  padding-right: 1rem;
  padding-bottom: 0.5rem;
  padding-left: 1rem;
	border-radius: 5px;
	box-shadow: 0 0 10px rgba(0, 0, 0, .2);
}

.main-box {
  border: 1px solid #808080;
  margin-top: 0.5rem;
  padding-top: 0.5rem;
  padding-right: 1.8rem;
  padding-bottom: 0.5rem;
  padding-left: 1.8rem;
  border-radius: 5px;
  box-shadow: 0 0 10px rgba(0, 0, 0, .2);
}

.font-125 {
  font-size: 125%;
}
.tag-btn {
  margin-bottom: 0.3em;
}

.content-2-title {
	margin-top: 2rem;
	margin-bottom: 0.5rem;
	margin-left: -0.5rem;
  border-bottom: 1px solid #808080;
  border-left: 4px solid #808080;
  padding-left: 0.5rem;
}
.content-2-title h3 {
	font-weight: 500;
  font-size: 20px;
}

.content-3-title {
	margin-top: 15px;
	margin-bottom: 10px;
  border-bottom: 1px solid #808080;
  border-left: 1px solid #808080;
  padding-left: 5px;
}

.content-3-title h3 {
	font-weight: 500;
  font-size: 18px;
}

ul, ol {
  padding-left:30px;
}

@media screen and (max-width: 479px) {

  .my-container {
    padding-right: 0.5rem;
    padding-left: 0.5rem;
  }

  .header-box {
    padding-right: 0.5rem;
    padding-left: 0.5rem;
  }

  .main-box {
    padding-right: 0.5rem;
    padding-left: 0.5rem;
  }

  .content-2-title {
    margin-left: -0.3rem;
  }

}
  


.figure-img {
  margin-bottom: 0.1rem;
  line-height: 1;
}
.figure-caption {
  font-size: 90%;
  color: inherit;
}

.smallbox {
  font-size: 70%;
  border-radius: 0.3rem;
  padding: 0.3rem;
  color: inherit;
}

pre {
  border: 1px solid #ccc;
	background: rgb(70,70,70);
	color: rgb(255,255,255);
  border-radius: 0.5rem;
  padding: 0.5rem;
}
pre code {
	font-family: inherit;
  font-size: inherit;
  color: inherit; 
  background-color: transparent;
  border-radius: 0;
}
code {
  padding: 2px 4px;
  color: #c7254e;
  background-color: #f9f2f4;
  border-radius: 5px;
}
.code-name {
  display: inline-block;
  padding: 2px 4px;
	background: #9090A0;
	color: rgb(255,255,255);
  font-size: inherit;
  border-radius: 0.5rem;
}

pre code span {
	font-family: inherit;
}

hr {
  background-color: #808080;
}



img,
iframe,
embed,
video,
audio {
  max-width: 100%;
}
.card-img,
.card-img-top,
.card-img-bottom {
  width: initial;
}

* {
	font-family: 'M PLUS 1p', sans-serif;
	font-weight: 400;
  word-wrap:break-word;
}

</style>
</head>
  <body class="d-flex flex-column">
    <div id="btitle-border" class="container-fluid my-container">
  
  
  
  
  
  
  
  
  
  
  
  <div id="btitle" class="btitle">
    <h3><a href="https://chromabox.github.io/140m">140文字以上</a></h3>
  </div>
  <div id="bstitle" class="bstitle">
    <h4>
      <p>140文字では伝わらないことを書いています。禁無断転載</p>
      <p>
        <a href="https://twitter.com/chromarock">twitter(@chromarock)</a>,
        <a href="https://github.com/chromabox">github</a>,
		    <a rel="me" href="https://mstdn.jp/@chromarock">Mastodon(jp)</a>,
		    <a rel="me" href="https://mastodon-japan.net/@chromarock">Mastodon(japanet)</a>,
		    <a rel="me" href="https://misskey.io/@chromarock">misskey</a>,
        <a href="https://www.amazon.jp/hz/wishlist/ls/2IWGNZS26U41G?ref_=wl_share">ほしいものリスト</a>,
        <a href="https://chromabox.github.io/140m/proof/">本人証明</a>,
        <a href="https://chromabox.github.io/140m/about/">その他プロフィール</a>
      </p>
  </h4>
  </div>
</div>

    <div class="container-fluid my-container">
      <main id="main">
        
<header class="header-box">
    


<div class="blog-post-date text-secondary">
    
    <i class="fa fa-clock"></i><time datetime="2022-05-11">2022-05-11</time>
    
</div>

    <h2 class="blog-post-title">
    <a class="text-dark text-decoration-none" href="https://chromabox.github.io/140m/linux/ubuntu2204_memo/">ubuntu 22.04設定メモ</a>
</h2>

    
<div class="blog-post-tags text-secondary">
    <strong>tags:</strong>
    
        <a class="btn btn-sm btn-outline-dark tag-btn" href="/tags/ubuntu">ubuntu</a>
    
        <a class="btn btn-sm btn-outline-dark tag-btn" href="/tags/linux">linux</a>
    
</div>


    

</header>
<div class="main-box">
<p>正式にUbnutu 22.04 LTSがリリースされ、Japan Remix（日本語環境向けに調整されたもの）もリリースされたので、18.04 LTSだった環境を入れ替えしました。</p>
<p>ちなみに、自分が確認した環境は以下です。</p>
<pre tabindex="0"><code>$ screenfetch
                          ./+o+-       xxx@xxxxxxxx
                  yyyyy- -yyyyyy+      OS: Ubuntu 22.04 jammy
               ://+//////-yyyyyyo      Kernel: x86_64 Linux 5.19.0-35-generic
           .++ .:/++++++/-.+sss/`      Uptime: 5h 29m
         .:++o:  /++++++++/:--:/-      Packages: 2186
        o:+o+:++.`..```.-/oo+++++/     Shell: bash
       .:+o:+o/.          `+sssoo+/    Resolution: 1920x1080
  .++/+:+oo+o:`             /sssooo.   DE: GNOME 41.7
 /+++//+:`oo+o               /::--:.   WM: Mutter
 \+/+o+++`o++o               ++////.   WM Theme: Adwaita
  .++.o+++oo+:`             /dddhhh.   GTK Theme: Yaru-dark [GTK2/3]
       .+.o+oo:.          `oddhhhh+    Icon Theme: Yaru
        \+.++o+o``-````.:ohdhhhhh+     Font: Ubuntu 11
         `:o+++ `ohhhhhhhhyo++os:      Disk: 1.8T / 8.2T (22%)
           .o:`.syhhhhhhh/.oo++o`      CPU: Intel Core i7-4790 @ 8x 4GHz [45.0°C]
               /osyyyyyyo++ooo+++/     GPU: NVIDIA GeForce GTX 960
                   ````` +oo+++o\:     RAM: 3960MiB / 15917MiB
                          `oo++.  
</code></pre>





<div class="content-2-title">
  <h3>
USB版のインストールイメージを作る
</h3>
</div>
<p>最近のPCはDVDドライブすらないとかままあるので、RaspberryPIなんかでよく使われているbalenaEtcherを使ってUSBメモリからライブUSBを作るのが早い。<br>
8GB以上のUSBメモリ推奨とのこと。</p>
<p><a href="https://www.balena.io/etcher/">https://www.balena.io/etcher/</a> に行ってAppimageをダウンロード</p>
<p>解凍して以下コマンドを実行</p>
<pre tabindex="0"><code>$ ./balenaEtcher-1.7.9-x64.AppImage
</code></pre><p>なお、etcherは内部的にElectronを使っていてこれはGUIの表示にChromiumレンダリングエンジンを使っていてぶっちゃけブラウザ上で走っているようなものなので（考えてみるとすごい時代だ…）、libvaのエラーが出てしまって起動しない場合がある。</p>
<p>特にnvidiaの新しいドライバを使用している場合などは以下のようにしてgpuを使用しないようにするとよい。</p>
<pre tabindex="0"><code>$ ./balenaEtcher-1.7.9-x64.AppImage --disable-gpu-sandbox
</code></pre><p>後はGUIが出てくるので、イメージを設定して、USBメモリも指定して「Flush」を押して書き込み</p>
<p>参考：<br>
<a href="https://kledgeb.blogspot.com/2022/04/ubuntu-2204-64-windowslinuxmacosubuntu.html">https://kledgeb.blogspot.com/2022/04/ubuntu-2204-64-windowslinuxmacosubuntu.html</a></p>
<br>






<div class="content-3-title">
  <h3>
小ネタ：FreeDOSをUSBから起動する方法
</h3>
</div>
<p>古いマシンを復活させようとしてBIOSをアップデートしないといけなかったりする場合があったりするとWindowsからかDOSから起動しないといけないことって多々ありますよね。<br>
そういう場合は先程の「balenaEtcher」とFreeDOSを使えばUbuntuでもDOSの起動USBメモリを生成できます。</p>
<p>FreeDOSはここ<br>
<a href="http://freedos.org/download/">http://freedos.org/download/</a>
から[FreeDOS 1.3 LiteUSB]をダウンロードすればOK。</p>
<p>そしてそれをbalenaEtcherで書けば動きます。楽ですね。</p>
<br>






<div class="content-2-title">
  <h3>
インストール時に気をつけること
</h3>
</div>
<p>インストール時に使用しているメディアにもよるが、最初のGrubの画面でカーネルのコマンドライン(引数)に</p>
<pre tabindex="0"><code>fsck.mode=skip
</code></pre><p>を指定しないとメディアに対してfsckをやってしまうらしく、インストーラが立ち上がるのが遅いことがあるそうなので気をつけること</p>
<br>






<div class="content-2-title">
  <h3>
Virtualboxにインストールする場合
</h3>
</div>
<p>USBメモリを使いたい場合はExtpackをインストールの後、これをしてLinux再起動</p>
<pre tabindex="0"><code>$ sudo gpasswd -a USER_NAME vboxusers
</code></pre><p>EFIを使用するにチェックを付けておくと、Boot時にVirtualBOXのロゴが出て解像度が少し上がる<br>
チェックを入れなくてもインストール自体は可能。</p>
<p>しかし解像度が最低の640*480になってしまい、インストーラのGUIがはみ出て選択できなくなる。</p>
<p>こういう場合はとりあえずインストーラのGUIが出てきたら「Ubunutuを試す」をやって、Live版が起動したら右下のアプリケーション表示のアイコンから「設定」を選び、「ディスプレイ」ー「解像度」を選び、1024*768とか選んで解像度を大きくしたあとで、Ubuntuをインストールするを実行すればOK</p>
<p>あと、UEFIではないのでディスク設定に注意(何も考えずデフォルトでインストールする分には問題ないが、インストールのついでにパーティションを切るとかBtrfsに入れたいとかする場合は注意)</p>
<br>






<div class="content-2-title">
  <h3>
インストール後の基本セット
</h3>
</div>
<p>自分はインストール後にまずこれをしてとりあえず必要なものをインストールしています</p>
<pre tabindex="0"><code>$ sudo apt update
$ sudo apt upgrade
$ sudo apt install build-essential cmake git gitk ssh gufw samba vim filezilla minicom mcomix gtkterm shutter vlc ffmpeg geany flatpak flex bison screenfetch htop apt-transport-https gnupg2 gnome-shell-extension-manager
</code></pre><br>






<div class="content-2-title">
  <h3>
Codecをまとめてインストール
</h3>
</div>
<p>動画のコーデック関連の話。Ubuntu18でもありましたね。<br>
Ubuntuのデフォルトでは権利関係が微妙な(微妙にライセンスがオープンじゃなかったり)怪しいものは除外される運命だけど、これをすることによってインストール出来るというアレ。</p>
<p>但し、libavcodecが消えてしまう(その代り権利怪しいアレなバージョンが入る)</p>
<pre tabindex="0"><code>$ sudo apt install ubuntu-restricted-extras
</code></pre><p>あれとか言ってるけど、動作的には問題ないので心配しないでほしい。どう違うか？は以下の通り。</p>
<p>libavcodec　－　権利がしっかりしたもの<br>
libavcodec-extra　－　ubuntu-restricted-extrasで勝手に入る。権利怪しいもの</p>
<br>






<div class="content-2-title">
  <h3>
リカバリーモード(Recovery mode)への入り方
</h3>
</div>
<p>Ubuntuはごくまれにですがグラフィックドライバの更新失敗などなどで、通常のGUIログイン画面が出てこなかったり、そうでなくてもディスクの故障などでこれもやはり通常のGUIで操作ができなくなり困る場面は出てくると思います。<br>
あとは、Nvidia系のグラフィックボードを入れたのだけどnouvauドライバが対応しておらずGUIにすら入れない状態ですね…</p>
<p>そういう場合はリカバリーモードで入って、rootシェルでなんとかして復旧させるということをします。<br>
とりあえずリカバリーモードへの入り方とネットワークの活かし方は以下です。</p>
<p>１．Grubの画面で「Advanced options for Ubuntu」を選択して、「起動するLinuxバージョン名の後ろに(recovery mode)」のものを選択<br>
２．しばらくするとメニュー画面が出るので「root」を選択<br>
３．Ctrl+Dを押すとなんとか…という画面が出るけど、ここでリターンを押してrootシェルに入る<br>
４. そのままではネットワークが動いておらず何もできんので、とりあえずip linkコマンドでLANインターフェイスの名前を見る(例だとeth0がそれ)</p>
<pre tabindex="0"><code># ip link
1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state DOWN mode DEFAULT group default qlen 1000
    link/ether xx:xx:xx:xx:xx:xx brd ff:ff:ff:ff:ff:ff
</code></pre><p>ここで「DOWN」になっているはずなので以下で復帰させます。<br>
これでとりあえずネットワークとインターネットが使えるようになって、apt updateなどが使用可能になります<br>
(これはDHCPがルータにある場合。ない場合はipコマンドでIPAddressを割り振ればOK)</p>
<pre tabindex="0"><code># ip link set eth0 up
# dhclient eth0
# systemctl start systemd-resolved
</code></pre><p>(余談：昔はrecovery modeでは読み取り専用マウントにされてしまうので、改めて読み書き可にするためのremountをしないといけなかったけど、いつの間にかそれをしなくても良くなったようです)</p>
<br>






<div class="content-2-title">
  <h3>
handbrakeでNVENCが使えない
</h3>
</div>
<p>古いPCにUbuntuを入れる活用法はあるあるだけど、nvencを使ってhanbbrakeでH.264やH.265のエンコードしたい場合はドライバのバージョンが390系だったりするとだめ。<br>
ドライバのバージョンが5xx系だと使用可能。</p>
<p>ここを見て自分が使っているビデオボードがエンコードをサポートしているGPUかまず確認しよう。<br>
<a href="https://developer.nvidia.com/video-encode-and-decode-gpu-support-matrix-new">https://developer.nvidia.com/video-encode-and-decode-gpu-support-matrix-new</a></p>
<p>これはOBSでnvencを使ってハードウェアエンコードしながら配信したい場合も同じなので注意。</p>
<br>






<div class="content-2-title">
  <h3>
Btrfsにインストール
</h3>
</div>
<p>20.04のときは確かBtrfsを選べなかった気がするが、22.04になってようやくBtrfsにも入れることができるようになった。<br>
Ext4と比べても良くなってるので、もうできる限りBtrfsにしましょう。<br>
→標準のUbuntuからインストールではなくて、Lubuntuフレーバでいきなりインストールする人はBtrfsで動かんらしいので気をつけよう</p>






<div class="content-2-title">
  <h3>
gnome-shell拡張の導入 (gnome-extension-manager)
</h3>
</div>
<p>Ubuntuのデフォルトではデスクトップの細かいカスタマイズができません<br>
gnome-shell拡張はこれを拡張してくれるやつで、入れておくと使い勝手が格段に向上するので入れておいたほうが吉です。</p>
<pre tabindex="0"><code>$ sudo apt install gnome-shell-extension-manager
</code></pre><p>これをしてから、<code>extension-manager</code>で探して起動するとGUIが出てくると思います。<br>
この中からオススメは以下です</p>
<pre tabindex="0"><code>Allow Locked Remote Desktop   
 Ubunutの標準のデスクトップ共有を使うと、画面をロックしたりログアウトするとリモートデスクトップが完全停止してしまい
 再び許可しないと受付してくれないのでそれをどうにかする拡張。
 したがって、標準のまま共有を使うにはほぼ必須級だがセキュリティは弱くなるので考えてから導入  
Applications Menu  
 アクティビティの横にアプリケーションメニューできて、そこからアプリを選べる
Frippery Move Clock
 時刻表示を通知バー右端に寄せるとかできる
NVIDIA GPU State Tool
 通知バーにGPUの温度とかを表示できる(NVidia GPU専用)
Status Area Horizonatal Spacing
 通知バーのスペース具合を調整できる
Vitals
 通知バーにCPU温度とかシステムの状況を表示できる
</code></pre><br>






<div class="content-2-title">
  <h3>
GuestAdditionCDの導入(Virtualbox環境)
</h3>
</div>
<p>Virtualboxにインストールしたときに「GuestAddition」を入れないとクリップボード共有が動かなかったり、解像度をウィンドウサイズに追従させられなかったり等色々不便なので現状は入れておくと良い。<br>
(本来はVboxSVGAを選択すれば要らないのだが動かないので)</p>
<p>まずgccなど必要なコンパイラ類をまとめて入れる</p>
<pre tabindex="0"><code>$ sudo apt install build-essential
</code></pre><p>この後でGuest addition CDを投入後、以下実行し、再起動でOK</p>
<pre tabindex="0"><code>$ cd /media/xxx/VBOXxxx
$ ./autorun.sh
</code></pre><br>






<div class="content-2-title">
  <h3>
google-chromeのインストール
</h3>
</div>
<p>以下のコマンドを打てばOK</p>
<pre tabindex="0"><code>$ sudo apt install apt-transport-https gnupg2
$ wget -O- https://dl.google.com/linux/linux_signing_key.pub | gpg --dearmor | sudo tee /usr/share/keyrings/google-chrome.gpg
$ echo deb [arch=amd64 signed-by=/usr/share/keyrings/google-chrome.gpg] http://dl.google.com/linux/chrome/deb/ stable main | sudo tee /etc/apt/sources.list.d/google-chrome.list
$ sudo apt update
$ sudo apt install google-chrome-stable
</code></pre><br>






<div class="content-2-title">
  <h3>
vscodeのインストール
</h3>
</div>
<p>以下のコマンドを打てばOK</p>
<pre tabindex="0"><code>$ sudo apt install apt-transport-https gnupg2
$ wget -O- https://packages.microsoft.com/keys/microsoft.asc | sudo gpg --dearmor | sudo tee /usr/share/keyrings/vscode.gpg
$ echo deb [arch=amd64 signed-by=/usr/share/keyrings/vscode.gpg] https://packages.microsoft.com/repos/vscode stable main | sudo tee /etc/apt/sources.list.d/vscode.list
$ sudo apt update
$ sudo apt install code
</code></pre><br>






<div class="content-2-title">
  <h3>
sshとsshd
</h3>
</div>
<p>sshが無いと色々めんどくさいので早めにやっておく。<br>
この辺はUbuntu18.04と同じ。</p>
<pre tabindex="0"><code>ub2204: $ sudo apt install ssh
</code></pre><p>もしもホスト側の<code>.ssh/config</code>が公開鍵オンリーになっていたら以下のようにホスト側のエントリーを書かないといけない</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">Host ub2204
</span></span><span class="line"><span class="cl">	User XXX
</span></span><span class="line"><span class="cl">	HostName YYY
</span></span><span class="line"><span class="cl">	port <span class="m">22</span>
</span></span><span class="line"><span class="cl">	IdentitiesOnly no
</span></span><span class="line"><span class="cl">	PreferredAuthentications password
</span></span></code></pre></div><p>これで一応PasswdでログインOK<br>
インストール直後は.sshが作られていないのでsshで入ったあとで自分で自分のサーバに入る</p>
<pre tabindex="0"><code>host: $ ssh ub2204
(Pass聞いてくる)
ub2204:$ ssh localhost
(FingerPrint合ってるかどうか聞いてくるのでYと答える)
(Pass聞いてくる)
ub2204:$ exit
</code></pre><p>ホスト側(もしあれば)で、ed25519な鍵生成</p>
<pre tabindex="0"><code>host: $ ssh-keygen -t ed25519
</code></pre><p>何処に出力するか聞いてくるので、設定して鍵ファイルを作る</p>
<p>インストール先に公開鍵を転送</p>
<pre tabindex="0"><code>host: $ scp (作った秘密鍵).pub (転送先サーバ名):/home/xxx/
</code></pre><p>転送先で鍵設定</p>
<pre tabindex="0"><code>ub2204:$ cp (作った秘密鍵).pub .ssh/authorized_keys
ub2204:$ chmod 600 .ssh/authorized_keys
</code></pre><p>セキュリティを高めるために、転送先のsshd_configを触って鍵オンリーにしてパスワードログインは禁止。<br>
<code>/etc/ssh/sshd_config</code>を以下のように変更</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">PubkeyAuthentication yes
</span></span><span class="line"><span class="cl">PasswordAuthentication no
</span></span></code></pre></div><p>最後に、sshdリスタート</p>
<pre tabindex="0"><code>ub2204:$ systemctl restart sshd
</code></pre><br>






<div class="content-2-title">
  <h3>
Samba設定
</h3>
</div>
<p>まず、Sambaをインストール</p>
<pre tabindex="0"><code>$ sudo apt install samba
</code></pre><p>次に<code>/etc/samba/smb.conf</code>に追記</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="o">[</span>ユーザ名<span class="o">]</span>
</span></span><span class="line"><span class="cl">        <span class="nv">path</span> <span class="o">=</span> /home/ユーザ名
</span></span><span class="line"><span class="cl">        <span class="nv">writeable</span> <span class="o">=</span> yes
</span></span><span class="line"><span class="cl">        <span class="nv">browseable</span> <span class="o">=</span> no
</span></span><span class="line"><span class="cl">        valid <span class="nv">users</span> <span class="o">=</span> ユーザ名
</span></span></code></pre></div><p>browseableは必要に応じて変える</p>
<p>sambaのパスワードをセットする</p>
<pre tabindex="0"><code>$ sudo smbpasswd -a ユーザ名
</code></pre><p>(-a を入れないとエラーになる)</p>
<p>最後にsmbdリスタート</p>
<pre tabindex="0"><code>$ sudo systemctl restart smbd
</code></pre><br>






<div class="content-2-title">
  <h3>
minicomなどで使用するターミナルの権限変更等
</h3>
</div>
<p><code>/dev/ttyS</code>なんとかのグループがdialoutになっているのでそれを利用する</p>
<pre tabindex="0"><code>$ sudo gpasswd -a ユーザ名 dialout
$ sudo chown root:dialout /etc/minicom
$ sudo chmod 775 /etc/minicom
</code></pre><p>詳細<br>
<a href="https://qiita.com/chromabox/items/306386a886bee4fb7810">https://qiita.com/chromabox/items/306386a886bee4fb7810</a></p>
<p>なお、デフォルトではFT23X系のチップを使用したUSBシリアル変換を接続すると、しばらく間をおいて途中で勝手に切られてしまう&hellip;.<br>
このときのdmesgはこんな感じ</p>
<pre tabindex="0"><code>[ 6114.316364] usb 1-3.4: New USB device found, idVendor=0403, idProduct=6001, bcdDevice= 6.00
[ 6114.316374] usb 1-3.4: New USB device strings: Mfr=1, Product=2, SerialNumber=3
[ 6114.316378] usb 1-3.4: Product: FT232R USB UART
[ 6114.316380] usb 1-3.4: Manufacturer: FTDI
[ 6114.316383] usb 1-3.4: SerialNumber: XXXXXXXX
[ 6114.319137] ftdi_sio 1-3.4:1.0: FTDI USB Serial Device converter detected
[ 6114.319181] usb 1-3.4: Detected FT232RL
[ 6114.320031] usb 1-3.4: FTDI USB Serial Device converter now attached to ttyUSB0
[ 6131.973998] usb 1-3.4: usbfs: interface 0 claimed by ftdi_sio while &#39;brltty&#39; sets config #1
[ 6131.975270] ftdi_sio ttyUSB0: FTDI USB Serial Device converter now disconnected from ttyUSB0
[ 6131.975311] ftdi_sio 1-3.4:1.0: device disconnected
[ 6572.726767] usb 1-3.4: USB disconnect, device number 9
</code></pre><p>調べるとどうやら「brltty」という点字関連のアクセシビリティのものが悪さをしているので、以下を実行してbrlttyをアンインストールするとよい</p>
<pre tabindex="0"><code>$ sudo apt remove brltty
</code></pre>





<div class="content-2-title">
  <h3>
flatpakの権限設定を変えたい
</h3>
</div>
<p>flatpakは便利なのですが権限設定がやりにくいというのがあります<br>
（権限関連でうまく動かなかったりするとかあります）</p>
<p>権限設定するにはflatsealをflatpakから入れるのが楽です</p>
<br>






<div class="content-2-title">
  <h3>
sudo apt autoremoveするとnvidiaドライバが何故か消えてしまいnouveauドライバになる
</h3>
</div>
<p>インストール時に3rdパーティのドライバをインストールするを選択すると、インストール後に自動的にNvidiaのドライバが入るようになって万々歳のところが、ここで。。。</p>
<pre tabindex="0"><code>$ sudo apt autoremove
</code></pre><p>をやってしまうと、再起動時に何故かNvidiaのドライバがなくなりnouveauドライバになってしまう<br>
こういうときは焦らずに</p>
<pre tabindex="0"><code>$ sudo ubuntu-drivers autoinstall
</code></pre><p>して、再起動すれば復活する。</p>
<br>






<div class="content-2-title">
  <h3>
gdm3でWaylandを無効にする
</h3>
</div>
<p>Ubuntu22.04もデフォルトではWaylandを使おうとする。<br>
しかし、barrierやteamviewer等色々と対応していないアプリはあるので、これらを動かすときはOFFにしておいたほうが無難。</p>
<p><code>/etc/gdm3/custom.conf</code>を以下のように、WaylandEnable=falseにする。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="o">[</span>daemon<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Uncoment the line below to force the login screen to use Xorg</span>
</span></span><span class="line"><span class="cl"><span class="nv">WaylandEnable</span><span class="o">=</span><span class="nb">false</span>
</span></span></code></pre></div><br>






<div class="content-2-title">
  <h3>
RDP（Ubuntu22.04で標準で入るようになったgnome-remote-desktop）について
</h3>
</div>
<p>Ubuntu22.04の目玉(？)機能の一つとしてリモートデスクトップが標準サポートされるようになりました。<br>
しかし、接続元のRemminaが古いとRDPで接続ができないとかあります。<br>
(例えば、Ubuntu20.04のデフォルトで入れられるRemminaなど)</p>
<p>これは、RemminaをSnap版にして新しいのを入れると問題なく接続できるようになります。<br>
Snap版にしたときは権限設定を忘れずに(ほとんどONでいいと思う)</p>
<p>この際なのでUbuntu22.04側のRemminaもSnap版に入れ替えしたほうが良いですね。</p>
<p>また、Wayland環境でもVNCでも画面をロックしたりログアウトするとリモートデスクトップが切れ、次に接続しようとしても受付しなくなります。これが地味にしんどい…<br>
(TeamviewerやWindowsリモートデスクトップのような完全なリモートデスクトップじゃなくて、gnome-remote-desktopは、操作アシスタント的な使い方を想定している…とのことのようです。)<br>
これなんですが、一応の解決策として<code>extension-manager</code>を入れてから<code>Allow Locked Remote Desktop</code>を入れるという手が使えます。<br>
これをすると、画面をロックしたりログアウトしてもリモートデスクトップ機能が切れずに受付はされるので活用したいヒトにはかなりの朗報です。</p>
<p>ただし、セキュリティには気をつけておかないといけないので、最低でもufwでポートを締めてsshと鍵認証でガッチリ固めておきましょう。
これの説明はとても長くなるのでこちらへ…</p>
<p>あとは昔からあるXRDPを使うという方法もあります。<br>
ただ、物理マシンを使うときにリモートがそのまま動いていると入れない（この逆もあり、物理マシンでログインしているとリモートからは同じユーザでログイン不可）とかいう場合が出てきたり、音声がうまく飛んでくれなかったりするのでケースバイケースですね</p>
<p>2方式の違いをまとめると次のような感じです<br>
「Ubuntu標準のリモートデスクトップ」: ユーザで画面を共有できる感じ。VNCやTeamviewerのRDP版。プロトコルがRDPなので軽い。デスクトップ音声も飛んでくる。<br>
「XRDP」: ユーザで画面は共有できず、ログインしたユーザに固定する。WindowsのProエディションで入ってくるリモートデスクトップのイメージに近い。XRDPはデスクトップ音声を飛ばすのは難しい</p>
<br>






<div class="content-2-title">
  <h3>
日本語がうまく入らない(ubuntu日本語Remix版では治っているかも)
</h3>
</div>
<p>そのままだと変換ボックスがウィンドウの下に出ます。<br>
ただそれだけではなく、geditなんかで日本語入力がおかしくなり非常に日本語入力が厳しくなる。。。</p>
<p>gsettingsの値がこうだとだめらしい</p>
<pre tabindex="0"><code>$ gsettings get org.gnome.desktop.interface gtk-im-module
&#39;&#39;
</code></pre><p>これが空なのがいけないようなので次のようにするとよい</p>
<pre tabindex="0"><code>$ gsettings set org.gnome.desktop.interface gtk-im-module &#39;ibus&#39;
</code></pre><p>参考：<br>
<a href="https://askubuntu.com/questions/1405101/japanese-input-candidate-window-appears-at-the-bottom-after-upgrading-ubuntu-fro">https://askubuntu.com/questions/1405101/japanese-input-candidate-window-appears-at-the-bottom-after-upgrading-ubuntu-fro</a></p>
<br>






<div class="content-2-title">
  <h3>
Flatpakのインストール
</h3>
</div>
<p>ubuntuはリリースバージョンでアプリのバージョンが固定されてしまうのでなるべくflatpakかsnapでリリースされているものを使うのが良いとのこと</p>
<pre tabindex="0"><code>$ sudo apt install flatpak
$ sudo flatpak remote-add --if-not-exists flathub https://flathub.org/repo/flathub.flatpakrepo
$ sudo apt install gnome-software-plugin-flatpak
</code></pre><p>これをしたあとで、gimpのページの<br>
<a href="https://www.gimp.org/downloads/">https://www.gimp.org/downloads/</a>
にある[install flatpak GIMP]をクリックしてflatpakrefを開くとflatpak版gimpがインストールできる</p>
<p>flatpakのアップデートは</p>
<pre tabindex="0"><code>$ flatpak update
</code></pre><p>でOK</p>
<br>






<div class="content-2-title">
  <h3>
Golangのインストール
</h3>
</div>
<p>18.04や20.04の場合はlongsleep/golang-backportsのppaを取り込む必要があったけど22.04は現時点で最新版がUbuntu標準に含まれているので必要ないとのこと<br>
(今後、Golangがアップデートされたりしたらまた必要になるのかも？)</p>
<p>というわけで以下でOK</p>
<pre tabindex="0"><code>$ sudo apt install golang-go
</code></pre><br>






<div class="content-2-title">
  <h3>
scrcpyのインストール
</h3>
</div>
<p>Android端末の画面をそのままコピーしてUbuntu上で操作できるようにするツール。かなり便利。<br>
snap版のほうが新しいので、例によってsnap版のをインストールすると良い（権限設定は忘れずに）</p>
<p>また、Android端末側はUSBデバッグを有効にするのと、初回接続時はこのPCからの接続を許可するか？の問答があるので設定をすること。</p>
<pre tabindex="0"><code>$ sudo snap install scrcpy
</code></pre><br>






<div class="content-2-title">
  <h3>
OBSのインストール
</h3>
</div>
<p>例によってflatpak版をインストール</p>
<p>１．公式からFlatpakをダウンロード<br>
２．ファイルマネージャー等で開く<br>
３．プラグインも全部入れる<br>
４．普通に起動</p>
<p>Webカメラが動作できて録画できることまでは確認。ただし配信は未確認（TwichかTwitterでの配信で問題ある環境があるとか？）<br>
v4l2関連でエラーが出るかもしれないらしい（自分の環境では出ず）</p>
<p>その時はこれをすると良いとのこと</p>
<pre tabindex="0"><code>$ apt install v4l-utils libv4l-dev
</code></pre><br>






<div class="content-2-title">
  <h3>
barrierについて
</h3>
</div>
<p>wayland環境は未対応なので注意すること。よって、gdm3のwaylandは外しておくこと。<br>
xorg環境でないと動きません。</p>
<p>調べたところ、2.4系はなんか変らしいので2.3.3でトライしました。</p>
<p>ビルドについてはこことほとんど同じだが、ubuntu22.04はlibqt4が無いのでlibqt4-devは外してしまって良い<br>
<a href="https://chromabox.github.io/140m/linux/barrier_ubuntu1804/">https://chromabox.github.io/140m/linux/barrier_ubuntu1804/</a></p>
<p>以下そのまま順に実行。/usr/local/binにbarrierが入ります。</p>
<pre tabindex="0"><code>$ sudo apt install cmake xorg-dev g++ libavahi-compat-libdnssd-dev libx11-dev libcurl4-openssl-dev qtbase5-dev libssl-dev
$ git clone https://github.com/debauchee/barrier.git
$ cd barrier
$ git checkout v2.3.3 -b v2.3.3_mod
$ wget https://gist.githubusercontent.com/chromabox/61404314887e61c1c32e325a6dc37e41/raw/a83699cc038dc547bb90aab6af6e810200ddee04/barrier-2_3_3-Fix-daemon-mode-execute-missing.patch
$ git am barrier-2_3_3-Fix-daemon-mode-execute-missing.patch
$ ./clean_build.sh
$ cd build
$ sudo make install
</code></pre><br>






<div class="content-2-title">
  <h3>
barriercの自動実行について
</h3>
</div>
<p>電源投入時にBarriercも自動実行させたいときはgdm3の設定が必要になる。<br>
lightdmのときと違い、gdm3の設定はなかなかに面倒</p>
<p>参考：<br>
<a href="http://masaoo.blogspot.com/2021/07/ubuntu-2004-gdm-synergyc.html">http://masaoo.blogspot.com/2021/07/ubuntu-2004-gdm-synergyc.html</a></p>
<p><code>/usr/share/gdm/greeter/autostart/barrierc.desktop</code>を新規作成</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-.sh" data-lang=".sh"><span class="line"><span class="cl"><span class="o">[</span>Desktop Entry<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="nv">Type</span><span class="o">=</span>Application
</span></span><span class="line"><span class="cl"><span class="nv">Name</span><span class="o">=</span>barrierc
</span></span><span class="line"><span class="cl"><span class="nv">Exec</span><span class="o">=</span>/usr/local/bin/barrierc --debug INFO --name <span class="o">(</span>このマシンの設定名<span class="o">)</span> <span class="o">(</span>サーバIP<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="nv">NoDisplay</span><span class="o">=</span><span class="nb">true</span>
</span></span><span class="line"><span class="cl">X-GNOME-AutoRestart<span class="o">=</span><span class="nb">true</span>
</span></span></code></pre></div><pre tabindex="0"><code>$ cd /etc/gdm3/PostLogin
$ sudo cp Default.sample Default
</code></pre><p><code>/etc/gdm3/PostLogin/Default</code>を編集</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-.sh" data-lang=".sh"><span class="line"><span class="cl"><span class="cp">#!/bin/sh
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="c1">#</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Note: this is a sample and will not be run as is.  Change the name of this</span>
</span></span><span class="line"><span class="cl"><span class="c1"># file to &lt;gdmconfdir&gt;/PostLogin/Default for this script to be run.  This</span>
</span></span><span class="line"><span class="cl"><span class="c1"># script will be run before any setup is run on behalf of the user and is</span>
</span></span><span class="line"><span class="cl"><span class="c1"># useful if you for example need to do some setup to create a home directory</span>
</span></span><span class="line"><span class="cl"><span class="c1"># for the user or something like that.  $HOME, $LOGIN and such will all be</span>
</span></span><span class="line"><span class="cl"><span class="c1"># set appropriately and this script is run as root.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">killall barrierc
</span></span></code></pre></div><p><code>/etc/gdm3/PostSession/Default</code>を編集</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-.sh" data-lang=".sh"><span class="line"><span class="cl"><span class="cp">#!/bin/sh
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl">/usr/bin/killall barrierc
</span></span><span class="line"><span class="cl"><span class="k">while</span><span class="o">[</span> <span class="k">$(</span>pgrep -x barrierc<span class="k">)</span> <span class="o">]</span><span class="p">;</span> <span class="k">do</span> sleep 0.1<span class="p">;</span> <span class="k">done</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">xauthfile</span><span class="o">=</span><span class="k">$(</span>ps aux <span class="p">|</span>grep Xauth <span class="p">|</span> grep <span class="s1">&#39;^root&#39;</span> <span class="p">|</span> grep -oP <span class="s1">&#39;\-auth \K[\w/]+&#39;</span><span class="k">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">DISPLAY</span><span class="o">=</span>:0
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">XAUTHORITY</span><span class="o">=</span><span class="si">${</span><span class="nv">xauthfile</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">/usr/local/bin/barrierc --debug INFO --name <span class="o">(</span>このマシンの設定名<span class="o">)</span> <span class="o">(</span>サーバIP<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">exit</span> <span class="m">0</span>
</span></span></code></pre></div><p>ログイン後に自動起動させたいので以下のようにする</p>
<pre tabindex="0"><code>$ cd ~/
$ mkdir bin
$ cd bin
$ touch start-barrierc.sh
$ chmod 775 start-barrierc.sh
</code></pre><p><code>start-barrierc.sh</code>を編集</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-.sh" data-lang=".sh"><span class="line"><span class="cl"><span class="cp">#!/bin/sh
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>/usr/bin/killall barrierc
</span></span><span class="line"><span class="cl"><span class="k">while</span> <span class="o">[</span> <span class="k">$(</span>pgrep -x barrierc<span class="k">)</span> <span class="o">]</span><span class="p">;</span> <span class="k">do</span> sleep 0.1<span class="p">;</span> <span class="k">done</span>
</span></span><span class="line"><span class="cl">/usr/local/bin/barrierc --debug INFO --name <span class="o">(</span>このマシンの設定名<span class="o">)</span> <span class="o">(</span>サーバIP<span class="o">)</span>
</span></span></code></pre></div><p>あとは、この<code>start-barrierc.sh</code>をUbuntuの「自動起動するアプリケーション」（システムツールの自動起動するアプリケーション）で指定してあげればOK</p>
<br>






<div class="content-2-title">
  <h3>
teamviewerを使いたい
</h3>
</div>
<p>gnome-extension-managerを入れることによってteamviewerをUbunut22.04で使う意義はまま薄れましたが、それでもLAN内からとかVPNでリンクされている箇所からとかじゃなくて、本当にグローバルなネットからでも接続できるとか利点はあるのでそういうことをしたい人向け。(最低でもVPN間接続して保護したほうがいいとは思うけど)<br>
teamviwereはWaylandセッションでは動かない(対応していない)ので気をつけること<br>
Waylandを事前に無効にしておくのが良いかもしれない。<br>
ただ、パフォーマンスはRDP(Ubuntuの標準デスクトップ共有)と比べるとやっぱり悪い</p>
<p>以下コマンドを順に入れればOK</p>
<pre tabindex="0"><code>$ sudo apt install wget apt-transport-https gnupg2
$ wget -O- https://download.teamviewer.com/download/linux/signature/TeamViewer2017.asc | gpg --dearmor | sudo tee /usr/share/keyrings/teamview.gpg
$ echo deb [arch=amd64 signed-by=/usr/share/keyrings/teamview.gpg] http://linux.teamviewer.com/deb stable main | sudo tee /etc/apt/sources.list.d/teamviewer.list
$ sudo apt update
$ sudo apt install teamviewer
</code></pre><p>インストール時に設定ファイルに差異があるけど、どうするか聞いてくるけどNで良い</p>
<br>






<div class="content-2-title">
  <h3>
hugoのインストール
</h3>
</div>
<p>最新が0.98.0なので最新をインストールする。<br>
なお、ubuntu 22.04で通常の方法でインストールすると0.92.2-1となる。<br>
※前提条件：Golangを入れておくこと</p>
<p>0.すでにHugoを入れてしまっている場合はアンインストール</p>
<pre tabindex="0"><code>$ sudo apt remove hugo
</code></pre><p>１．ここから最新のdebを落とす(extend付きが良い。0.98.0で確認)<br>
<a href="https://github.com/gohugoio/hugo/releases/">https://github.com/gohugoio/hugo/releases/</a></p>
<p>２．以下コマンドでインストール。/usr/localにインストールされる</p>
<pre tabindex="0"><code>$ sudo dpkg -i ./hugo_extended_0.98.0_Linux-64bit.deb
</code></pre><p>３．確認</p>
<pre tabindex="0"><code>$ hugo version
hugo v0.98.0-165d299cde259c8b801abadc6d3405a229e449f6+extended linux/amd64 BuildDate=2022-04-28T10:23:30Z VendorInfo=gohugoio
$ which hugo
/usr/local/bin/hugo
</code></pre><br>






<div class="content-2-title">
  <h3>
vpnを起動時にONにする（問題あり）
</h3>
</div>
<p>参考：<br>
<a href="https://itectec.com/ubuntu/ubuntu-20-04lts-networkmanager-vpn-always-on/">https://itectec.com/ubuntu/ubuntu-20-04lts-networkmanager-vpn-always-on/</a></p>
<p>nm-connection-editor を使いましょうということらしい<br>
が、nm-connection-editorを使うと電源再投入後にLANが有効にならないという問題がある…（調査中）</p>
<br>






<div class="content-2-title">
  <h3>
Lubuntuを後から入れる
</h3>
</div>
<p>18.04のときのようにこれをする</p>
<pre tabindex="0"><code>$ sudo apt install -y lubuntu-desktop
</code></pre><p>しかし、今回ディスプレイマネージャはsddmを使うらしい…ということでgdm3かsddmかを聞いてくる<br>
自分はgdm3をやってみました。<br>
sddmはまた後ほど…</p>
<p>Ubuntuを普通に入れた後でLubuntuを入れると日本語設定もそのままなので楽。<br>
Lubuntuから入れるとBtrfsで起動しない問題があるそうだが、この方法だとBtrfsに入れても起動しないということはない。</p>
<p>少し試した感じでは特に問題はなかったです。<br>
ただ、Ubuntuの標準もだいぶこなれてはきたので今更Lubuntuもという感じは多少あります…</p>
<br>






<div class="content-2-title">
  <h3>
Kdenliveについて
</h3>
</div>
<p>動画編集アプリのkdenliveです<br>
例によってFlatpak版。<br>
なお、現状はFlatpak版が一番新しいようです。<br>
<a href="https://kdenlive.org/en/download/">https://kdenlive.org/en/download/</a></p>
<p>再生にGPU支援を使用するを有効にしてしまうと駄目なので気をつけよう。<br>
snap版もインストールしてみたものの、モーショントラッカーを設定するときに範囲指定をマウスでできなかったので使用せず。</p>
<br>






<div class="content-3-title">
  <h3>
小ネタ1：モーショントラッカーの使い方
</h3>
</div>
<p>動く物体に対して色々したい場合に使うあれ。<br>
昔はAutoMaskだったが、名前が変わって安定性と機能が大幅向上してMotionTrackerに生まれ変わっている。<br>
エフェクト選択ではMotion Trackerを選ぶと良い。</p>
<p>トラッキングアルゴリズムも色々ある。<br>
細かいパラメータなど詳しくは<a href="https://docs.kdenlive.org/en/effects_and_compositions/effect_groups/alpha_manipulation/motion_tracker.html">ここ</a>を参照。</p>
<br>






<div class="content-3-title">
  <h3>
小ネタ2：DaSIAM RPNトラッカーの使い方
</h3>
</div>
<p>OpenCVなんかで使用できるDaSIAM RPNをkdenliveで気軽に試すことができる。<br>
これはディープラーニングのモデルに基づいていて、他のアルゴリズムと違って精度はなかなか良さげ。<br>
Distractor-aware Siamese Networks for Visual Object Trackingというそうな<br>
VOT-18 challenge（毎年モーショントラックを競い合う競技）で勝ったそうな、なんか知らんけどすごい。</p>
<p><a href="https://github.com/foolwood/DaSiamRPN">https://github.com/foolwood/DaSiamRPN</a><br>
論文<br>
<a href="https://arxiv.org/pdf/1808.06048.pdf">https://arxiv.org/pdf/1808.06048.pdf</a></p>
<p>ただ、デフォルトでは学習モデルが用意されていない。<br>
どこからか持ってきて設定する必要がある。</p>
<p>しかしこれはKdeが公式に用意していて、まずは以下のファイルをダウンロード<br>
<a href="https://files.kde.org/kdenlive/motion-tracker/DaSiamRPN/dasiamrpn_kernel_cls1.onnx">https://files.kde.org/kdenlive/motion-tracker/DaSiamRPN/dasiamrpn_kernel_cls1.onnx</a>
<a href="https://files.kde.org/kdenlive/motion-tracker/DaSiamRPN/dasiamrpn_kernel_r1.onnx">https://files.kde.org/kdenlive/motion-tracker/DaSiamRPN/dasiamrpn_kernel_r1.onnx</a>
<a href="https://files.kde.org/kdenlive/motion-tracker/DaSiamRPN/dasiamrpn_model.onnx">https://files.kde.org/kdenlive/motion-tracker/DaSiamRPN/dasiamrpn_model.onnx</a></p>
<p>このダウンロードしたファイルをFlatpak版の場合は<br>
$HOME/.var/app/org.kde.kdenlive/data/kdenlive/opencvmodels
にコピー</p>
<p>その後はいつものようにMotionTrackerを設定後、[Tracker Algorithm]を[DaSIAM]にして[解析]を押せばOK</p>
<br>






<div class="content-2-title">
  <h3>
ファイル単位での完全消去
</h3>
</div>
<p>消す前に3度ランダムデータを書いてから消すあれ<br>
rmの変わりにshredを使うのもいいが事故ると困るので「File Shredder」を使うと良い。<br>
Flatpakでのみ存在しているのでflatpakをセットアップの後、アプリセンターから「Shredder」を検索してインストール。</p>
<br>






<div class="content-2-title">
  <h3>
ディスクの完全消去
</h3>
</div>
<p>Ubuntuに限らずLinuxにはcoreutilsにshredというコマンドがある。<br>
NSA方式(3度ランダムデータ書く)でディスクを完全消去ができる</p>
<pre tabindex="0"><code>$ sudo shred -uvz &lt;ファイルシステム名&gt;
</code></pre><p>全領域に対して3回ランダムデータを書くのでかなり時間がかかる。<br>
実施の際は色々確認した上で、UbuntuのLiveUSBにも入っているのでLiveUSBからやったほうがいいかもしれない。</p>
<br>






<div class="content-2-title">
  <h3>
snap版remminaで個々の接続の設定ができず落ちる、ある日突然接続できなくなって落ちるなどあった場合の対処法
</h3>
</div>
<p>Snapの権限設定になんの問題もなく、Remminaを開いて[設定]-[オプション]-[Remminaのデータフォルダ]が<br>
<code>/home/user/snap/remmina/バージョン/.local/share/remmina/</code><br>
になっていて、dmesgの結果</p>
<pre tabindex="0"><code>[87494.552862] audit: type=1400 audit(1653524117.897:180): apparmor=&#34;DENIED&#34; operation=&#34;mknod&#34; profile=&#34;snap.remmina.remmina&#34; name=&#34;/home/user/snap/remmina/バージョン/.local/share/remmina/XXX.remmina.YYYYYYY&#34; pid=141664 comm=&#34;remmina&#34; requested_mask=&#34;c&#34; denied_mask=&#34;c&#34; fsuid=1000 ouid=1000
</code></pre><p>とか、AppArmorでDENYされて蹴られている場合は、データフォルダに原因がある。<br>
よってこの[Remminaのデータフォルダ]を他の場所に移す。</p>
<p>Remminaを一旦終わらせた後で以下のようにして、接続設定を移しておく</p>
<pre tabindex="0"><code>$ cd ~
$ mkdir remmina_data
$ cp ~/snap/remmina/current/.local/share/remmina/* remmina_data/
</code></pre><p>その後、Remminaを再起動して[設定]-[オプション]-[Remminaのデータフォルダ]を<br>
<code>/home/user/remmina_data</code><br>
に指定。<br>
その後、もう一度Remminaを再起動すればOK。</p>
<p>これはSnap版Remminaのコンフィグに前のバージョンのデータDIRの設定が残っていて、そこに書かれた前のSnapバージョンのDirを参照しようとしてAppArmorに「それは違うだろ」って蹴られていることが原因だが、Remminaプロジェクトはこれを治す気はないようで、データDirを共通の場所に移してほしいと言っている。</p>
<p><a href="https://gitlab.com/Remmina/Remmina/-/issues/2548#note_622712677">https://gitlab.com/Remmina/Remmina/-/issues/2548#note_622712677</a></p>
<p>他のSnapアプリだとそういうことはあまりないのでうーんと言ったところだけど、微妙にハマりポイントですねこれ…</p>
<br>






<div class="content-2-title">
  <h3>
使用カーネルをMainlineにする(13世代Intel向け)
</h3>
</div>
<p>Ubuntu22.04はRaptorなどの比較的新しいCPUに完全には対応していません。<br>
これには（AlderはCPUにもよりますが）PコアとEコアという2種類のスペックの違うコアが協調して動いており（ハイローミックス）、ある程度はCPUで面倒を見る感じなのですが、完全にきれいにスケジューリングするにはOSでも対応が必要となっています。<br>
Alderは5.16から対応が始まっており、Ubuntu 22.04をアップデートしていれば現在は5.19になっているので特に何もすることはないのですが、Raptorに関しては6.1からの対応ということで、カーネルを自力で上げるかUbuntu公式が変えてくれるのを待つしかありません。</p>
<p>昔はUbuntuで使っているカーネルを自力更新するのは手間だったわけですが、現在は <code>Ubuntu Mainline Kernel Installer</code> というものがありGUIで入れ替えることができ相当楽になっています。</p>
<p><code>Ubuntu Mainline Kernel Installer</code>は以下のようにしてインストールします。</p>
<pre tabindex="0"><code>sudo add-apt-repository ppa:cappelikan/ppa
sudo apt update
sudo apt -y install mainline
</code></pre><p>その後、<code>Ubuntu Mainline Kernel Installer</code>を起動して、使用したいカーネルバージョンを選択すればOKです。</p>
<p>





<div class="content-2-title">
  <h3>
UEFIが有効になっているようなPCでBIOS画面に入りたい
</h3>
</div>
最近、ようやくBootがUEFIなPCにUbuntuを入れることになってハマりそうになったので…</p>
<p>UEFIなPCにUbuntuを入れて電源を入れるとUEFI BIOSの設定によっては間髪入れずgrubが立ち上がってどうやってBIOSに入るんだこれみたいな感じになりますが、そんなときはこれをすると良いそうな</p>
<pre tabindex="0"><code>$ sudo systemctl reboot --firmware-setup
</code></pre><p>これを実行すると再起動して、すぐさまUEFIなBIOSに入れます。(最近のWindowsで言うところの[システム]→[回復]からの[トラブルシューティング]のあれみたいなもんですな)<br>
めでたしめでたし。<br>
(なお、poweroffコマンドもrebootコマンドも実体はsystemctlだったりします)</p>






<div class="content-2-title">
  <h3>
gdbでlibなんとかなどの既にインストールされているライブラリのデバッグをしたい
</h3>
</div>
<p>主にプログラムを作る人向けの話です<br>
ubuntuのデフォルトではgdb（や、そこにつながるvscode）でコードのデバッグをするときに既にインストールされているライブラリの挙動が観たい場合があります。<br>
そのときにそのライブラリのデバッグシンボル情報が入っていないと、正しく追っかけることができません。<br>
デフォルトでは入れてくれないので、以下手順で入れます。</p>
<p>１．デバッグシンボル用の鍵を入れる</p>
<pre tabindex="0"><code>$ sudo apt install ubuntu-dbgsym-keyring
</code></pre><p>２．デバッグシンボルのパッケージのダウンロード先をaptに教えるために<code>ddebs.list</code>を追加する</p>
<pre tabindex="0"><code>$ echo -e &#34;deb http://ddebs.ubuntu.com $(lsb_release -cs) main restricted universe multiverse \ndeb http://ddebs.ubuntu.com $(lsb_release -cs)-updates main restricted universe multiverse \ndeb http://ddebs.ubuntu.com $(lsb_release -cs)-proposed main restricted universe multiverse&#34; |  sudo tee -a /etc/apt/sources.list.d/ddebs.list &gt; /dev/null
</code></pre><p>３．パッケージリストを更新</p>
<pre tabindex="0"><code>$ sudo apt update
</code></pre><p>４．必要なデバッグ対象のライブラリのシンボルを得る(例ではlibcurl4とstdcのデバッグシンボル)</p>
<pre tabindex="0"><code>$ sudo apt install libcurl4-dbgsym libstdc++6-11-dbg
</code></pre><p>これでgdbは一応シンボルを探してくれます。</p>
<p>実は22.04以降ではこれをしなくても<code>Debuginfod</code>というサービスが有効にできて、自動的にシンボルをUbuntuサーバからダウンロードしてくれるという便利機能があるのですが、時々まともに動かずgdbそのものがうんともすんとも言わないことがあるので手動インストールしたほうが無難かな…という感じです。</p>
<BR>






<div class="content-2-title">
  <h3>
画像をきれいにアップスケールしたい（超解像に特化した機械学習を使ってアップスケール）
</h3>
</div>
<p>小さい画像を手軽にきれいにアップスケールしたいなんてことはよくあるかなと思います。<br>
そういう場合は、ESRGANの一種の実装であるRealESRGANを入れるのが良いです。<br>
ESRGANというのは、元々SRGAN(Super-Resolution Generative Adversarial Network)っていう深層学習系のがあって、これは深層学習を利用した超解像＝元画像を強化学習器を使ってできるだけきれいにアップスケールする手法なのですが、それにEがついてEnhanced SRGAN＝ESRGANというわけですな。</p>
<p>で、RealESRGANは元々Pythonを入れないといけなかったりするのですが、RealESRGANのプロジェクトページには親切にもVulkanさえあれば動くものも用意されています。<br>
試した所GTX960でも動きました。<br>
ということでなかなか良さげなのですが、sudo apt では入れられないので以下手順を踏む必要があります。</p>
<p>１．githubにあるRealesrganのプロジェクトからportable版を落としてくる</p>
<pre tabindex="0"><code>$ wget realesrgan-ncnn-vulkan-20220424-ubuntu.zip  
</code></pre><p>２．落としてきたものを解凍</p>
<pre tabindex="0"><code>$ unzip realesrgan-ncnn-vulkan-20220424-ubuntu.zip
</code></pre><p>３．ここから<code>realesrgan-ncnn-vulkan</code>に実行権限を付与して、<code>realesrgan-ncnn-vulkan</code>と<code>models</code>を実行パスを指定しているパスへコピー</p>
<pre tabindex="0"><code>$ chmod +x realesrgan-ncnn-vulkan
$ cp realesrgan-ncnn-vulkan /usr/local/bin/
$ cp -r models /usr/local/bin/
</code></pre><p>以上で使えます。
こんな感じで使うと良いです<br>
(例ではsrc.pngを2倍にしてdst.pngを生成します。モデルはアニメビデオに強いrealesr-animevideov3を指定)</p>
<pre tabindex="0"><code>$ realesrgan-ncnn-vulkan -i src.png -o dest.png -s 2 -n realesr-animevideov3 -v
MESA-INTEL: warning: Haswell Vulkan support is incomplete
[0 NVIDIA GeForce GTX 960]  queueC=0[16]  queueG=0[16]  queueT=1[2]
[0 NVIDIA GeForce GTX 960]  bugsbn1=0  bugbilz=105  bugcopc=0  bugihfa=0
[0 NVIDIA GeForce GTX 960]  fp16-p/s/a=1/1/0  int8-p/s/a=1/1/1
[0 NVIDIA GeForce GTX 960]  subgroup=32  basic=1  vote=1  ballot=1  shuffle=1
[1 llvmpipe (LLVM 15.0.7, 256 bits)]  queueC=0[1]  queueG=0[1]  queueT=0[1]
[1 llvmpipe (LLVM 15.0.7, 256 bits)]  bugsbn1=0  bugbilz=0  bugcopc=0  bugihfa=0
[1 llvmpipe (LLVM 15.0.7, 256 bits)]  fp16-p/s/a=1/1/1  int8-p/s/a=1/1/1
[1 llvmpipe (LLVM 15.0.7, 256 bits)]  subgroup=8  basic=1  vote=1  ballot=1  shuffle=1
[2 Intel(R) HD Graphics 4600 (HSW GT2)]  queueC=0[1]  queueG=0[1]  queueT=0[1]
[2 Intel(R) HD Graphics 4600 (HSW GT2)]  bugsbn1=0  bugbilz=0  bugcopc=0  bugihfa=0
[2 Intel(R) HD Graphics 4600 (HSW GT2)]  fp16-p/s/a=1/0/0  int8-p/s/a=1/0/0
[2 Intel(R) HD Graphics 4600 (HSW GT2)]  subgroup=32  basic=1  vote=1  ballot=1  shuffle=1
0.00%
25.00%
50.00%
75.00%
src.png -&gt; dest.png done
</code></pre><p>あと、当然なんですが元画像はある程度解像度があったほうがいいです。<br>
256x256くらいからかなとは思います。</p>
<p>なお、Realesrganのプロジェクトは以下にあります。<br>
ソースコードからビルドしたい人はこの辺から<code>git clone</code>すればいいと思います。<br>
<a href="https://github.com/xinntao/Real-ESRGAN">https://github.com/xinntao/Real-ESRGAN</a><br>
<a href="https://github.com/xinntao/Real-ESRGAN-ncnn-vulkan">https://github.com/xinntao/Real-ESRGAN-ncnn-vulkan</a></p>
<p>もし、UbuntuのGUIでお手軽にやりたい場合は「Upscaler」というFlathubのアプリがRealESRGAN-Vulkanを内包しているようなのでそれを使うのがいいと思います。<br>
普通にソフトウェアから検索したらFlathub版が出てくるのでそれを入れましょう。<br>
ただし、倍率は4倍固定になってたりFlathub特有の制限があるので、FlatsealでHomeディレクトリを許可するかアクセスできるディレクトリを有効にする必要があります。</p>
<BR>






<div class="content-2-title">
  <h3>
Stable Diffusion Web UI（AUTOMATIC1111）を動かす  
</h3>
</div>
<p>画像生成AIのアレです。<br>
最近何かと騒がしているStable Diffusionですが、素の実装ではコマンドラインだけだったり簡単には動かしにくいものになっています。<br>
ということでフロントエンドをかぶせて、ブラウザ上から実行できあたかもGUIアプリとして利用できるようにしたのが、Stable Diffusion Web UI（AUTOMATIC1111）となります。</p>
<p>Ubuntuでも以前はCUDAライブラリやらcuDNNライブラリを入れたり色々しないとGPUが使えなかったり、Pythonのバージョンを合わせないと動かなかったんですが、最近だとvenvという仮想環境みたいなのをWebUI側が使ってくれるおかげで元のUbuntuの環境を触らずにCUDAもcuDNNも使って動くようになったので素のUbuntuに気軽に入れられるようになりました。<br>
(わざわざDocker環境を作る必要性も下がりました)</p>
<p>以下手順で簡単にセットアップできます。(GPUがnvidiaの場合)</p>
<p>１．GPU用にnvidiaのドライバを入れます。<br>
さすがに標準で入ってくる「nouveau」ドライバでは動きません。<br>
nvidiaのドライバを入れる必要があります。<br>
これは全く難しくなく、「追加のドライバー」で出てくる最新のドライバーでOKです。</p>
<p>２．Python類を入れ、stable-diffusion-webuiのソースをgithubから取ってくる</p>
<pre tabindex="0"><code>$ sudo apt install google-perftools python3 python3-pip python3-venv
$ git clone https://github.com/AUTOMATIC1111/stable-diffusion-webui.git
(必要に応じてTagを変更する。masterは安定版になっているようだ)
</code></pre><p>３．stable-diffusion-webui/webui-user.shに書かれている以下の表記を、インストール先に変える</p>
<pre tabindex="0"><code>#install_dir=&#34;/home/$(whoami)&#34;
</code></pre><p>４．実行</p>
<pre tabindex="0"><code>cd stable-diffusion-webui
$ ./webui.sh --listen --port 7860 --allow-code --xformers --enable-insecure-extension-access --api
</code></pre><p>これで http://0.0.0.0:7860 に接続すればWebUIの画面が出ます。<br>
初回実行時にroot権限を要求されることすらないので、元のUbuntu環境を変更していないということも解ると思います。<br>
かなり簡単ですね。</p>
<hr>

</div>

      </main>
    </div>
    
    <div class="container-fluid my-container">
    <div>
        
        <a href="https://twitter.com/intent/tweet?url=https%3a%2f%2fchromabox.github.io%2f140m%2flinux%2fubuntu2204_memo%2f&text=140%e6%96%87%e5%ad%97%e4%bb%a5%e4%b8%8a%3a%20ubuntu%2022.04%e8%a8%ad%e5%ae%9a%e3%83%a1%e3%83%a2" target="_blank" title="Tweet"><i class="btn btn-outline-dark fab fa-twitter"> 共有する</i></a>
        <i id="copy_share" class="btn btn-outline-dark fa fa-clipboard" title="クリップボードにリンクとタイトルをコピー" data-url="https://chromabox.github.io/140m/linux/ubuntu2204_memo/" data-title="140文字以上: ubuntu 22.04設定メモ" > 共有用にコピー</i>
    </div>
</div>

    
    
<footer id="footer" class="mt-auto text-center text-muted">
  <div class="container-fluid my-container">
    Made with <a href="https://gohugo.io/">Hugo</a> &amp; base theme <a href="https://github.com/zwbetz-gh/vanilla-bootstrap-hugo-theme">Vanilla</a>
</div>
</footer>

    <script src="https://chromabox.github.io/140m/js/feather.min.js"></script>
<script>
  feather.replace()
</script>
<script src="https://chromabox.github.io/140m/js/code-title.js"></script>


<script src="https://chromabox.github.io/140m/js/jquery-3.6.4.slim.min.js"></script>
<script src="https://chromabox.github.io/140m/js/bootstrap.bundle.min.js"></script>
<script src="https://chromabox.github.io/140m/js/share-clip.js"></script>


    


<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css"
  integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq"
  crossorigin="anonymous"
/>


<script
  defer
  src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js"
  integrity="sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz"
  crossorigin="anonymous"
></script>


<script
  defer
  src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js"
  integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI"
  crossorigin="anonymous"
  onload="renderMathInElement(document.body);"
></script>


    
  

  </body>
</html>